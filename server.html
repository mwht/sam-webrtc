<!DOCTYPE html>
<html>
	<head>
		<script src="https://cdn.jsdelivr.net/npm/peerjs@0.3.20/dist/peer.min.js"></script>
		<script>
			var message;
			function connect() {
				const peer = new Peer({
				  config: {'iceServers': [
					{ url: 'stun:stun.l.google.com:19302' },
				  ]}
				});
				peer.on('error', err => {
					alert(err);
				});
				peer.on('open', function(id) {
					document.getElementById("our-id").innerHTML = id;
				});
				peer.on('call', mediaConnection => {
					console.log("inbound connection");
					mediaConnection.answer();
					mediaConnection.on('stream', mediaStream => {
						document.getElementById("their-stream").srcObject = mediaStream;
					});
				});
				peer.on('connection', dataConnection => {
					message = dataConnection;
				});
				document.getElementById("connbutton").disabled = true;
			}

			window.onkeyup = function(e) {
				let json = {
					"type": "keyboard",
					"event": {
						"eventType": "up",
						"eventData": e.key
					}
				}
				message.send(JSON.stringify(json))
			}

			window.onkeydown = function(e) {
				let json = {
					"type": "keyboard",
					"event": {
						"eventType": "down",
						"eventData": e.key
					}
				}
				message.send(JSON.stringify(json))
			}
		</script>
	</head>
	<body>
		<video autoplay id="their-stream"></video><br />
		Our ID: <span id="our-id">...</span>
		<button onclick="connect()" id="connbutton">Connect</button>
	</body>
</html>
